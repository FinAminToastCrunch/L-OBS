# L-OBS in PyTorch

## Introduction
This is an implementtaion for L-OBS using PyTorch. The reason why we transfer it from TensorFlow to PyTorch is that [PyTorch model zoo]() provides official and easy-attain pretrained models.

## Requirement
Experiments are conducted under:

- TensorFlow 1.3.0

- PyTorch 0.3.0.post4

(Other version of TensorFlow and PyTorch are under testing)

## How to use
Take AlexNet as an example:

For prunning a network, you need to firstly prepare the PyTorch model description file `modes/alexnet.py` (can be found in [here](https://github.com/pytorch/vision/tree/master/torchvision/models)) and rewrite it to generate layer input as examples in `models/alexnet_layer_input.py`. 

Currently I have uploaded modified models for AlexNet, VGG16BN, ResNet, more models will be uploaded latter.

Then you need to download the pretrained model and put it in `./AlexNet`folder, ownload link can be found in `models/AlexNet.py`

Generate Hessian inverse using `generate-Hessian-inv-AlexNet.py`

Prune network using `prune-weights-AlexNet.py`

Validate the network using `validate-AlexNet.py`

## Attention
- Two methods for generating Hessian inverse are provided: 1) normal Hessian calculation and 2) Woodbury Hessian inverse calculation. By default, Hessian inverse for convolution and res layer is generated by normal Hessian calculation while fully-connect layer by Woodbury. If you meet overflow problem in prunning, please regenerate the Hessian inverse using Woodbury Hessian inverse calculation. If the problem is still unsolved, please leave the situation in issue.

- If your GPU/CPU memory is limited, you can set a smaller `hessian_batch_size` and larger `stride_factor`in `generate-Hessian-Inv-AlexNet.py` 

- Before you use the code, an ImageNet dataset should be prepared. Pay attention that PyTorch uses a different validation folder structure. You need to refine the val folder under [this](https://github.com/pytorch/examples/tree/master/imagenet).

## To be continued
- [ ] Example codes for L-OBS in VGG16, ResNet, GoogleNet
- [ ] Experiment details